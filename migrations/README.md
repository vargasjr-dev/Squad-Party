# Database Migrations

This folder contains SQL migration files generated by Drizzle Kit.

## Workflow

### Development

```bash
# After modifying shared/schema.ts:
npm run db:generate    # Generates a new migration file

# Review the generated SQL file in this folder
# Commit the migration with your schema changes
```

### Applying Migrations

```bash
# CLI (development):
npm run db:migrate

# Programmatic (production):
npx tsx server/migrate.ts
```

### Other Commands

```bash
npm run db:push      # Direct push (skips migrations - dev only)
npm run db:studio    # Opens Drizzle Studio to inspect DB
```

## Migration Files

Migration files are named with timestamps for ordering:
- `0000_initial_schema.sql`
- `0001_add_user_email.sql`
- etc.

**Never manually edit committed migrations** - this can cause inconsistencies between environments.

## First-Time Setup

If the database is new and empty:

1. Run `npm run db:generate` to create initial migration from current schema
2. Run `npm run db:migrate` to apply it

If migrating from `db:push` to migrations:

1. Run `npm run db:generate` - this creates a migration representing current schema
2. Mark it as applied without running: the DB already has these tables from `db:push`
   - Delete the generated file OR
   - Manually insert into `__drizzle_migrations` table
3. Going forward, use `db:generate` + `db:migrate` for all schema changes
